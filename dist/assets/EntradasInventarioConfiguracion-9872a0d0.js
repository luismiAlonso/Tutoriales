import{r as c,a as de,j as l}from"./index-c9f7c851.js";import{u as Fe,a as _e,P as ie,p as le,R as Ge,b as ze,c as Ue,d as h,o as We,e as Xe}from"./variablesGlobalesApi-75360325.js";import{s as d,g,o as ce,S as Ye}from"./dateUtil-160cab1d.js";import{u as Je,a as Ke,H as Ze}from"./useOrdenProductionStore-9340e8f0.js";import{u as qe}from"./useModal-cc5c5792.js";import{u as se}from"./useCustomDatepicker-f33899c5.js";import{B as Qe,C as et}from"./BackButtonComponent-2a9031fc.js";const re=[{title:"IDPRODUCTO",idInput:"idProducto",value:1,content:"",type:"number",editable:!0,visible:!1,defaultValue:1,additionalStyles:"",options:[""],placeHolder:""},{title:"FECHAENTRADA",idInput:"fechaEntrada",value:"",content:"",type:"noInput",editable:!1,visible:!1,defaultValue:"",additionalStyles:"",options:[],placeHolder:""},{title:"FECHASALIDA",idInput:"fechaSalida",value:"",content:"",type:"noInput",editable:!1,visible:!1,defaultValue:"",additionalStyles:"",options:[],placeHolder:""},{title:"PLANCHA",idInput:"plancha",value:"PL.B CREPELINA OSB 75",content:"",type:"hybridSelect",editable:!0,visible:!0,defaultValue:"PL.B CREPELINA OSB 75",additionalStyles:"",options:["PL.B CREPELINA OSB 75","PL.B CREPELINA OSB 90","PL. EVA F-25 114x216","PL.B GOMFLEX","PL. ECOFLEX 2 100x100","PL.Z CUEROLITE","PL PAVIGOM EX. 100x100","PL.B CREPELINA OSB 70"],placeHolder:""},{title:"COLOR",idInput:"color",content:"",value:"NEGRO",type:"hybridSelect",editable:!0,visible:!0,additionalStyles:"",defaultValue:"NEGRO",options:["NEGRO","BEIGE","ANGORA"],placeHolder:""},{title:"DIBUJO",idInput:"dibujo",content:"",value:"RAYADO 1",type:"hybridSelect",editable:!0,visible:!0,additionalStyles:"",defaultValue:"RAYADO 1",options:["RAYADO 1","LISO","TRAMA","LISO","LOGO"],placeHolder:""},{title:"MOLDE",idInput:"molde",content:"",value:"molde01",type:"hybridSelect",editable:!0,visible:!0,additionalStyles:"",defaultValue:"molde01",options:["molde02","molde03","molde04","molde05","molde06"],placeHolder:""},{title:"CALIBRE",idInput:"calibre",content:"",value:"3 m/m",type:"hybridSelect",editable:!0,visible:!0,additionalStyles:"",defaultValue:"3 m/m",options:["3 m/m","3.5 m/m","4 m/m","4.5 m/m","25 m/m"],placeHolder:""},{title:"ACABADO01",idInput:"acabado01",content:"",value:"acabado_01",type:"hybridSelect",editable:!0,visible:!0,additionalStyles:"",defaultValue:"acabado_01",options:["acabado_01","acabado_02","acabado_03","acabado_04","acabado_05"],placeHolder:""},{title:"ACABADO02",idInput:"acabado02",content:"",value:"acabado_01",type:"hybridSelect",editable:!0,visible:!0,additionalStyles:"",defaultValue:"acabado_01",options:["acabado_01","acabado_02","acabado_03","acabado_04","acabado_05"],placeHolder:""},{title:"STOCK",idInput:"stock",content:"",value:1,type:"text",editable:!1,visible:!1,additionalStyles:"",defaultValue:1,options:[],placeHolder:""},{title:"cantidadEntrante",idInput:"cantidadEntrante",value:1,content:"",type:"number",editable:!1,visible:!0,defaultValue:1,additionalStyles:"",options:[""],placeHolder:""},{title:"cantidadSalida",idInput:"cantidadSalida",value:0,content:"",type:"number",editable:!1,visible:!1,defaultValue:1,additionalStyles:"",options:[""],placeHolder:""},{title:"boton",idInput:"agregarEntrada",content:"Agregar",value:"",type:"button",editable:!1,visible:!0,additionalStyles:"",options:[],placeHolder:""}],tt=()=>{const[p,S]=c.useState(null),m=de(),{totalProductosInventario:f,setListaTotalProductosInventario:i}=Je(),[,P]=c.useState(),[,x]=c.useState(),{isOpen:O,setIsOpen:D,openModal:M,closeModal:A}=qe(),[E,s]=c.useState(!1),[L,_]=c.useState(""),{filterByWords:ue,filterData:G,filterDateRange:ve}=Ke(),[R,B]=c.useState([]),[pe,me]=c.useState("desc"),[fe,u]=c.useState(),[be,b]=c.useState(),[N]=c.useState(["fechaEntrada","fechaSalida","dibujo","color","acabado01","acabado02","molde","planchas","cantidadEntrante","cantidadSalida","clalibre","stock"]),[k,ye]=c.useState(N[0]),{getInventarioSelected:I,crearNuevoInventario:z,updateProductoIventario:U,getLastProductGroupInventario:W,mapearProductoInventarioAColumnas:X,mapColumnDescriptorsToProductoInventario:Y,generarMatrizColumnDescriptors:v,updateColumnDescriptor:J,getAllInvetariosAlmacen:he,deleteByClaveComp:ge,getLastProductInventarioByClaveComp:K,generarMatrizStyle:y}=Fe(),{currentPage:Se,itemsPerPage:Ie,loadedData:C,setLoadedData:Ce,calculateItemToDisplay:Ae,loadMoreData:Ee}=_e(20),[H,Le]=c.useState(re),[T,j]=c.useState(ie),Pe=(e,t)=>{const a=J(H,t,e,re);if(a&&(Le(a),d("tempDataEntrada",a)),E){const n=J(T,t,e,ie);n&&j(n)}},xe=e=>{e.preventDefault(),s(!1)},Z=()=>{console.log("Open Modal"),M()},Oe=()=>{A()},De=async(e,t)=>{const a=g("futureInventario");if(e==="agregarEntrada"){if(a)try{const n=Y(H,["agregarEntrada"]);q(a,n)}catch(n){console.error("Error en handleButtonClick:",n)}}else if(e==="Borrar"){const n=g("futureInventario");m(`${n.url}/${t}`,{replace:!0}),S(f[t]),Z()}else if(e!=="Editar"){if(e==="entradas"){if(C){_("entradas");const n=X(ze,C[t]);j(n),s(!0)}}else if(e==="salidas"){if(C){_("salidas");const n=X(Ue,C[t]);j(n),s(!0)}}else if(e==="guardar"){const n=g("futureInventario"),o=Y(T,["guardar"]);L==="entradas"?q(n,o):L==="salidas"&&Me(n,o),s(!1)}}},Me=async(e,t)=>{const a=await I(e.url);if(t.fechaSalida=ce("dd/MM/yyyy HH:mm:ss"),t.seccion=e.inventarioAlmacen.seccion,t.almacen=e.inventarioAlmacen.almacen,a){const n=V(t);t.claveComp=n;const o=K(a,t.claveComp);if(o){if(o.producto.stock-t.cantidadSalida<0)return;t.stock=o.producto.stock-t.cantidadSalida,t.ultimoRegistro=!0,o.producto.ultimoRegistro=!1,a.inventario.splice(o.indice+1,0,t)}U(`${e.url}/${t.idProducto}`,a).then(r=>{if(r){e.inventarioAlmacen=a,d("futureInventario",e),i(a.inventario);const w=v(h,a.inventario);u(w);const F=y(a.inventario);b(F)}})}},q=async(e,t)=>{const a=await I(e.url);if(t.fechaEntrada=ce("dd/MM/yyyy HH:mm:ss"),t.seccion=e.inventarioAlmacen.seccion,t.almacen=e.inventarioAlmacen.almacen,a){const n=V(t);t.claveComp=n;const o=K(a,t.claveComp),r=await We(`/indice/${e.inventarioAlmacen.almacen}/${e.inventarioAlmacen.seccion}`);r&&(t.idProducto=r),o?(t.stock=t.cantidadEntrante+o.producto.stock,t.ultimoRegistro=!0,o.producto.ultimoRegistro=!1,a.inventario.splice(o.indice+1,0,t)):(t.stock=t.cantidadEntrante,t.ultimoRegistro=!0,a.inventario.push(t)),U(`${e.url}/${t.idProducto}`,a).then(w=>{if(w){e.inventarioAlmacen=a,d("futureInventario",e),i(a.inventario);const F=v(h,a.inventario);u(F);const we=y(a.inventario);b(we)}})}else{Xe(`/indice/${e.inventarioAlmacen.almacen}/${e.inventarioAlmacen.seccion}`),t.idProducto=1,t.claveComp=V(t),t.stock=t.cantidadEntrante,t.ultimoRegistro=!0;const n={seccion:e.inventarioAlmacen.seccion,almacen:e.inventarioAlmacen.almacen,inventario:[t]};if(await z(e.url,n)){e.inventarioAlmacen=n,d("futureInventario",e),i(n.inventario);const r=v(h,n.inventario);u(r)}$()}},Re=async(e,t,a)=>{const n={url:e,inventarioAlmacen:{seccion:t,almacen:a,inventario:[]}},o=await I(e);return x(e),o&&o.inventario&&(n.inventarioAlmacen.inventario=o.inventario),d("futureInventario",n),i(n.inventarioAlmacen.inventario),n},Be=(e,t,a)=>{if(e.preventDefault(),console.log(a),t==="btDelete"){const n=g("futureInventario");if(n&&p){const o=encodeURIComponent(p.claveComp);ge(`${n.url}/completo`,o).then(r=>{r&&(console.log("el producto se ha eliminadocon exito ",n.url),$(),A())})}}},Ne=async()=>{const e=await he("ListadoInventario");if(e){d("allinventariosAlmacen",e),i(e),B(e);const t=v(le,e);u(t);const a=y(e);b(a)}else console.log("no tengo nada")},$=async()=>{const e=g("futureInventario");try{const t=await I(e.url),a=await W(e.url);if(d("groupProducts",a),a&&P(a),t&&t.inventario&&a)if(t&&t.inventario){e.inventarioAlmacen.inventario=t.inventario,d("futureInventario",e),i(t.inventario),B(t.inventario);const n=v(h,t.inventario);u(n);const o=y(t.inventario);b(o)}else console.log("La base de datos no contiene inventario con esa definiciÃ³n");else e.inventarioAlmacen.inventario=[],u([]),d("futureInventario",e),i([]),B([])}catch(t){console.error("Error al actualizar el inventario:",t)}},V=e=>`${e.seccion}-${e.almacen}-${e.plancha}-${e.molde}-${e.dibujo}-${e.color}-${e.calibre}-${e.acabado01}-${e.acabado02}`,Q=(e,t)=>{e&&t&&e<=t&&R&&ve(R,"fechaEntrada",e,t,pe).then(a=>{i(a)})},{selectedDate:ee,changeSelectedDate:te}=se(new Date,{onSelectedDateChanged:e=>{Q(e,ke)}}),{selectedDate:ke,changeSelectedDate:ae}=se(new Date,{onSelectedDateChanged:e=>{Q(ee,e)}}),He=()=>{},Te=()=>{},je=(e,t)=>{e==="byWords"&&(t===""?i(R):ue(f,t,k,"asc").then(a=>{console.log("entro :",a),i(a)}))},ne=(e,t)=>{if(e==="Orden")me(t.sortDirection),G(f,k,t.sortDirection).then(a=>{i(a)});else if(e==="Mostrar"){const a=g("futureInventario");if(d("mostrarDatos",t.value),a)try{t.value?W(a.url).then(n=>{if(n){const o=v(h,n);u(o);const r=y(n);b(r),i(n)}}):I(a.url).then(n=>{if(n){const o=v(h,n.inventario);u(o);const r=y(n.inventario);b(r),i(n.inventario)}})}catch(n){console.error("Error al obtener los productos:",n)}}},oe=e=>{const t=e.target.value;ye(t)},$e=e=>{G(f,e,"asc").then(t=>{i(t)})},Ve=[{type:"text",idInput:"byWords",activeButton:!1,activeSearchIcon:!0,placeHolder:"write to search...",activeLabel:!0,typeFill:"search",readonly:!0,style:"block w-32 p-1 pl-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",onChange:He,onClick:Te,onFilter:je},{idInput:"selectPropiedades",type:"select",activeLabel:!0,optionsSelect:N,idSelected:"selectPropiedades",selectClassName:"mt-4 mb-4 w-1/4",value:k,defaultValue:N[0],onSeleccion:oe,onFilter:$e,onChange:oe},{idInput:"selectedStartDate",activeLabel:!0,type:"date",language:"ES",formTarget:"dd/MM/yyyy",labelClearButton:"Limpar",name:"selectedStartDate",onSelectedDateChanged:te},{idInput:"selectedEndDate",activeLabel:!0,type:"date",language:"ES",formTarget:"dd/MM/yyyy",labelClearButton:"Limpar",name:"selectedEndDate",onSelectedDateChanged:ae},{idInput:"Orden",type:"toggle",activeLabel:!0,valueProp:!1,trueText:"asc",falseText:"desc",onChange:ne},{idInput:"Mostrar",type:"toggle",activeLabel:!0,valueProp:!0,trueText:"unico",falseText:"multiple",onChange:ne}];return{handleInputChange:Pe,handleButtonClick:De,crearNuevoInventario:z,prepareDataInventarioEntradas:Re,setLoadedData:Ce,calculateItemToDisplay:Ae,actualizaInvinterario:$,loadMoreData:Ee,handleOpenModal:Z,handleCloseModal:Oe,setIsOpen:D,handleDeleteProducto:Be,handleBackEditMod:xe,changeSelectedStartDate:te,changeSelectedEndDate:ae,actualizaAllinventarios:Ne,mappedStyleTable:be,plantillaProductoInventarioListado:le,mappeddProductosInventario:fe,plantillaFiltersInventario:Ve,selectedStartDate:ee,datosModificacion:T,ResumenProductoInventario:Ge,resumeProduct:p,isOpen:O,editMode:E,currentPage:Se,itemsPerPage:Ie,loadedData:C,datosEntrada:H}};function rt(){const p=["bamburi","cortado01","cortado02","lacado"],S=["Mok","otra1"],[m,f]=c.useState(p[0]),[i,P]=c.useState(S[0]),{prepareDataInventarioEntradas:x}=tt(),O=de(),D=s=>{f(s)},M=s=>{console.log(s.target.value),P(s.target.value)},A=()=>{const s=`/EntradasInventarioPage/${m}/${i}`;x(s,m,i).then(L=>{L&&O(s)})},E=()=>{};return l.jsxs("form",{className:"text-white",children:[l.jsxs("div",{className:"bg-zinc-700 p-4 rounded mb-6 flex justify-between items-center",children:[l.jsx("div",{className:"flex-grow text-left",children:l.jsx("h2",{children:"CONFIGURA INVENTARIO"})}),l.jsx("div",{children:l.jsx(Qe,{})})]}),l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-start",children:[l.jsxs("div",{className:"md:mr-4 mb-4 md:mb-0",children:[l.jsx("label",{children:"Seccion"}),l.jsx(Ze,{idInput:"seccion",editable:!0,activeLabel:!1,additionalStyles:"",type:"hybrid",options:p,defaultValue:m,value:m,onChange:D})]}),l.jsxs("div",{children:[l.jsx("label",{children:"Almacen"}),l.jsx(Ye,{idInput:"seccion",activeLabel:!1,type:"select",selectClassName:"",idSelected:S[0],value:i,defaultValue:i,optionsSelect:S,onChange:M,onSeleccion:E})]}),l.jsxs("div",{className:"m-4",children:[l.jsx("label",{className:"invisible",children:"confirmar"}),l.jsx(et,{buttonText:"Confirmar",className:"mt-4 md:mt-0 clase-personalizada",onClick:s=>{s.preventDefault(),A()}})]})]})]})}export{rt as default};
