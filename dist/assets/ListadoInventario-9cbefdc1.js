import{r as p,a as $e,j as t}from"./index-c9f7c851.js";import{u as Fe,a as _e,P as we,p as $,R as Ge,b as Ue,c as ze,o as Ye,e as We,d as Xe}from"./variablesGlobalesApi-75360325.js";import{g as F,o as oe,s as _,S as Je}from"./dateUtil-160cab1d.js";import{u as Ke,a as Ze,H as qe}from"./useOrdenProductionStore-9340e8f0.js";import{u as Qe}from"./useModal-cc5c5792.js";import{u as ie}from"./useCustomDatepicker-f33899c5.js";import{C as ue,B as se}from"./BackButtonComponent-2a9031fc.js";import{a as re,b as et,c as tt,d as ce,C as at,F as nt,I as lt,L as ot}from"./filtersComponent-4173453f.js";import{M as it}from"./ModalComponent-ccb1285e.js";const de=[{title:"IDPRODUCTO",idInput:"idProducto",value:1,content:"",type:"number",editable:!0,visible:!1,defaultValue:1,additionalStyles:"",options:[""],placeHolder:""},{title:"",idInput:"seccion",value:"",content:"",type:"text",editable:!1,visible:!1,defaultValue:1,additionalStyles:"",options:[""],placeHolder:""},{title:"",idInput:"almacen",value:"",content:"",type:"text",editable:!1,visible:!1,defaultValue:1,additionalStyles:"",options:[""],placeHolder:""},{title:"FECHAENTRADA",idInput:"fechaEntrada",value:"",content:"",type:"noInput",editable:!1,visible:!1,defaultValue:"",additionalStyles:"",options:[],placeHolder:""},{title:"FECHASALIDA",idInput:"fechaSalida",value:"",content:"",type:"noInput",editable:!1,visible:!1,defaultValue:"",additionalStyles:"",options:[],placeHolder:""},{title:"PLANCHA",idInput:"plancha",value:"PL.B CREPELINA OSB 75",content:"",type:"hybridSelect",editable:!1,visible:!0,defaultValue:"PL.B CREPELINA OSB 75",additionalStyles:"",options:["PL.B CREPELINA OSB 75","PL.B CREPELINA OSB 90","PL. EVA F-25 114x216","PL.B GOMFLEX","PL. ECOFLEX 2 100x100","PL.Z CUEROLITE","PL PAVIGOM EX. 100x100","PL.B CREPELINA OSB 70"],placeHolder:""},{title:"COLOR",idInput:"color",content:"",value:"NEGRO",type:"hybridSelect",editable:!1,visible:!0,additionalStyles:"",defaultValue:"NEGRO",options:["NEGRO","BEIGE","ANGORA"],placeHolder:""},{title:"DIBUJO",idInput:"dibujo",content:"",value:"RAYADO 1",type:"hybridSelect",editable:!1,visible:!0,additionalStyles:"",defaultValue:"RAYADO 1",options:["RAYADO 1","LISO","TRAMA","LISO","LOGO"],placeHolder:""},{title:"MOLDE",idInput:"molde",content:"",value:"molde01",type:"hybridSelect",editable:!1,visible:!0,additionalStyles:"",defaultValue:"molde01",options:["molde02","molde03","molde04","molde05","molde06"],placeHolder:""},{title:"CALIBRE",idInput:"calibre",content:"",value:"3 m/m",type:"hybridSelect",editable:!1,visible:!0,additionalStyles:"",defaultValue:"3 m/m",options:["3 m/m","3.5 m/m","4 m/m","4.5 m/m","25 m/m"],placeHolder:""},{title:"ACABADO01",idInput:"acabado01",content:"",value:"acabado_01",type:"hybridSelect",editable:!1,visible:!0,additionalStyles:"",defaultValue:"acabado_01",options:["acabado_01","acabado_02","acabado_03","acabado_04","acabado_05"],placeHolder:""},{title:"ACABADO02",idInput:"acabado02",content:"",value:"acabado_01",type:"hybridSelect",editable:!1,visible:!0,additionalStyles:"",defaultValue:"acabado_01",options:["acabado_01","acabado_02","acabado_03","acabado_04","acabado_05"],placeHolder:""},{title:"STOCK",idInput:"stock",content:"",value:1,type:"text",editable:!0,visible:!0,additionalStyles:"",defaultValue:1,options:[],placeHolder:""},{title:"cantidadEntrante",idInput:"cantidadEntrante",value:1,content:"",type:"text",editable:!1,visible:!0,defaultValue:1,additionalStyles:"w-full px-3 py-2 text-gray-900 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 block dark:bg-gray-700 dark:border-blue-600 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",options:[""],placeHolder:""},{title:"cantidadSalida",idInput:"cantidadSalida",value:1,content:"",type:"text",editable:!1,visible:!1,defaultValue:1,additionalStyles:"w-full px-3 py-2 text-gray-900 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 block dark:bg-gray-700 dark:border-blue-600 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",options:[""],placeHolder:""},{title:"Guardar",idInput:"guardar",content:"Guardar",value:"",type:"button",editable:!1,visible:!0,additionalStyles:"",options:[],placeHolder:""}],st=()=>{const[r,h]=p.useState(null),c=$e(),{totalProductosInventario:a,setListaTotalProductosInventario:d}=Ke(),[,g]=p.useState(""),{isOpen:v,setIsOpen:u,openModal:f,closeModal:i}=Qe(),[y,m]=p.useState(!1),[C,I]=p.useState(""),{filterByWords:L,filterData:P,filterDateRange:k}=Ze(),[S,j]=p.useState([]),[A,pe]=p.useState("desc"),[E,w]=p.useState(),[ve,M]=p.useState(),[fe,G]=p.useState(),[O]=p.useState(["fechaEntrada","fechaSalida","dibujo","color","acabado01","acabado02","molde","planchas","cantidadEntrante","cantidadSalida","clalibre","stock"]),[N,be]=p.useState(O[0]),{getInventarioSelected:R,crearNuevoInventario:U,updateProductoIventario:z,getLastProductGroupInventario:he,mapearProductoInventarioAColumnas:Y,mapColumnDescriptorsToProductoInventario:W,generarMatrizColumnDescriptors:B,updateColumnDescriptor:ye,getAllInvetariosAlmacen:ge,deleteByClaveComp:me,getLastProductInventarioByClaveComp:X,generarMatrizStyle:J}=Fe(),{currentPage:xe,itemsPerPage:Ie,loadedData:T,setLoadedData:Se,calculateItemToDisplay:Ce,loadMoreData:Pe}=_e(20),[K]=p.useState(de),[D,H]=p.useState(we),je=(e,l)=>{if(y){const o=ye(D,l,e,de);o&&H(o)}},Le=e=>{e.preventDefault(),m(!1)},Z=()=>{console.log("Open Modal"),f()},ke=()=>{i()},Ae=async(e,l)=>{const o=F("futureInventario");if(e==="agregarEntrada"){if(o)try{const n=W(K,["agregarEntrada"]);q(n)}catch(n){console.error("Error en handleButtonClick:",n)}}else if(e==="Borrar"){const n=F("futureInventario");c(`${n.url}/${l}`,{replace:!0}),h(a[l]),Z()}else if(e!=="Editar"){if(e==="entradasListado"){if(T){I("entradas");const n=Y(Ue,a[l]);w(a[l]),H(n),m(!0)}}else if(e==="salidasListado"){if(T){I("salidas");const n=Y(ze,a[l]);w(a[l]),H(n),m(!0)}}else if(e==="guardar"){const n=W(D,["guardar"]);E&&(n.seccion=E.seccion,n.almacen=E.almacen),C==="entradas"?q(n):C==="salidas"&&Ee(n),m(!1)}}},Ee=async e=>{const l=`EntradasInventarioPage/${e.seccion}/${e.almacen}`,o=await R(l);if(e.fechaSalida=oe("dd/MM/yyyy HH:mm:ss"),o){const n=V(e);e.claveComp=n;const s=X(o,e.claveComp);if(s){if(s.producto.stock-e.cantidadSalida<0)return;e.stock=s.producto.stock-e.cantidadSalida,e.ultimoRegistro=!0,s.producto.ultimoRegistro=!1,o.inventario.splice(s.indice+1,0,e)}z(`${l}/${e.idProducto}`,o).then(b=>{b&&x()})}},q=async e=>{const l=`EntradasInventarioPage/${e.seccion}/${e.almacen}`,o=await R(l);if(e.fechaEntrada=oe("dd/MM/yyyy HH:mm:ss"),o){const n=V(e);e.claveComp=n;const s=X(o,e.claveComp),b=await Ye(`/indice/${e.almacen}/${e.seccion}`);b&&(e.idProducto=b),s?(e.stock=e.cantidadEntrante+s.producto.stock,e.ultimoRegistro=!0,s.producto.ultimoRegistro=!1,o.inventario.splice(s.indice+1,0,e)):(e.stock=e.cantidadEntrante,e.ultimoRegistro=!0,o.inventario.push(e)),z(`${l}/${e.idProducto}`,o).then(Ve=>{Ve&&x()})}else{We(`/indice/${e.almacen}/${e.seccion}`),e.idProducto=1,e.claveComp=V(e),e.stock=e.cantidadEntrante,e.ultimoRegistro=!0;const n={seccion:e.seccion,almacen:e.almacen,inventario:[e]};if(await U(l,n)){d(n.inventario);const b=B(Xe,n.inventario);M(b)}x()}},Me=async(e,l,o)=>{const n={url:e,inventarioAlmacen:{seccion:l,almacen:o,inventario:[]}},s=await R(e);return g(e),s&&s.inventario&&(n.inventarioAlmacen.inventario=s.inventario),_("futureInventario",n),d(n.inventarioAlmacen.inventario),n},Oe=(e,l,o)=>{if(e.preventDefault(),console.log(o),l==="btDelete"){const n=F("futureInventario");if(n&&r){const s=encodeURIComponent(r.claveComp);me(`${n.url}/completo`,s).then(b=>{b&&(console.log("el producto se ha eliminadocon exito ",n.url),x(),i())})}}},x=async()=>{const e=await ge("ListadoInventario");if(e){_("allinventariosAlmacen",e),d(e),j(e);const l=B($,e);M(l);const o=J(e);G(o)}else console.log("no tengo nada")},V=e=>`${e.seccion}-${e.almacen}-${e.plancha}-${e.molde}-${e.dibujo}-${e.color}-${e.calibre}-${e.acabado01}-${e.acabado02}`,Q=(e,l)=>{e&&l&&e<=l&&S&&k(S,"fechaEntrada",e,l,A).then(o=>{d(o)})},{selectedDate:ee,changeSelectedDate:te}=ie(new Date,{onSelectedDateChanged:e=>{Q(e,Ne)}}),{selectedDate:Ne,changeSelectedDate:ae}=ie(new Date,{onSelectedDateChanged:e=>{Q(ee,e)}}),Re=()=>{},Be=()=>{},Te=(e,l)=>{e==="byWords"&&(l===""?d(S):L(a,l,N,"asc").then(o=>{console.log("entro :",o),d(o)}))},ne=(e,l)=>{if(e==="Orden")pe(l.sortDirection),P(a,N,l.sortDirection).then(o=>{d(o)});else if(e==="Mostrar"){const o="EntradasInventarioPage";_("mostrarDatos",l.value);try{l.value?he(o).then(n=>{if(n){const s=B($,n);M(s);const b=J(n);G(b),d(n),j(n)}}):x()}catch(n){console.error("Error al obtener los productos:",n)}}},le=e=>{const l=e.target.value;be(l)},De=e=>{P(a,e,"asc").then(l=>{d(l)})},He=[{type:"text",idInput:"byWords",activeButton:!1,activeSearchIcon:!0,placeHolder:"write to search...",activeLabel:!0,typeFill:"search",style:"block w-32 p-1 pl-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",readonly:!1,onChange:Re,onClick:Be,onFilter:Te},{idInput:"selectPropiedades",type:"select",activeLabel:!0,optionsSelect:O,idSelected:"selectPropiedades",selectClassName:"mt-4 mb-4 w-1/4",value:N,defaultValue:O[0],onSeleccion:le,onFilter:De,onChange:le},{idInput:"selectedStartDate",activeLabel:!0,type:"date",language:"ES",formTarget:"dd/MM/yyyy",labelClearButton:"Limpar",name:"selectedStartDate",onSelectedDateChanged:te},{idInput:"selectedEndDate",activeLabel:!0,type:"date",language:"ES",formTarget:"dd/MM/yyyy",labelClearButton:"Limpar",name:"selectedEndDate",onSelectedDateChanged:ae},{idInput:"Orden",type:"toggle",activeLabel:!0,valueProp:!1,trueText:"asc",falseText:"desc",onChange:ne},{idInput:"Mostrar",type:"toggle",activeLabel:!0,valueProp:!0,trueText:"unico",falseText:"multiple",onChange:ne}];return{handleInputChange:je,handleButtonClick:Ae,crearNuevoInventario:U,prepareDataInventarioEntradas:Me,setLoadedData:Se,calculateItemToDisplay:Ce,loadMoreData:Pe,handleOpenModal:Z,handleCloseModal:ke,setIsOpen:u,handleDeleteProducto:Oe,handleBackEditMod:Le,changeSelectedStartDate:te,changeSelectedEndDate:ae,actualizaAllinventarios:x,mappedStyleTable:fe,plantillaProductoInventarioListado:$,mappeddProductosInventario:ve,plantillaFiltersInventario:He,selectedStartDate:ee,datosModificacion:D,ResumenProductoInventario:Ge,resumeProduct:r,isOpen:v,editMode:y,currentPage:xe,itemsPerPage:Ie,loadedData:T,datosEntrada:K}},rt=({data:r,column:h,rowIndex:c,dataColumn:a,onInputChange:d,onButtonClick:g})=>{const v=(i,y)=>{d(i,h.idInput,y)},u=(i,y)=>{i.preventDefault(),g(h.idInput,y)},f=a.visible?"":"invisible";switch(a.type){case"text":return t.jsx("td",{className:"text-center",children:t.jsx(ce,{value:r[a.idInput],defaultValue:a.defaultValue,onChange:i=>v(i,c),placeholder:a.placeHolder,readOnly:!a.editable,additionalStyles:a.additionalStyles,type:a.type,shouldReset:!0})});case"number":return t.jsx("td",{className:"text-center",children:t.jsx(ce,{value:r[a.idInput],defaultValue:a.defaultValue,onChange:i=>v(i,c),placeholder:a.placeHolder,readOnly:!a.editable,additionalStyles:a.additionalStyles,type:a.type,shouldReset:!0})});case"dropdown":return t.jsx("td",{className:"text-center",children:t.jsx(Je,{idInput:a.idInput,type:"select",activeLabel:!0,selectClassName:"",idSelected:a.idInput,value:r[a.idInput],defaultValue:a.defaultValue,optionsSelect:a.options,onSeleccion:()=>{},onChange:i=>v(i.target.value,c)})});case"hybridSelect":return t.jsx("td",{className:"text-center",children:t.jsx(qe,{type:"hybrid",idInput:a.idInput,activeLabel:!0,editable:a.editable,additionalStyles:"",options:a.options||[],defaultValue:a.defaultValue,value:r[a.idInput],onChange:i=>v(i,c)})});case"checkbox":return t.jsx("td",{className:"text-center",children:t.jsx("input",{type:"checkbox",checked:r[a.idInput],onChange:i=>v(i.target.checked,c)})});case"button":return t.jsx("td",{className:"text-center",children:t.jsx("div",{className:f,children:t.jsx(ue,{buttonText:a.content,onClick:i=>{a.value!==void 0&&u(i,c)}})})});case"svg":return a.idInput==="Editar"?t.jsx("td",{className:"text-center",children:t.jsx("div",{className:f,children:t.jsx(re,{onClick:i=>{a.value!=null&&u(i,c)},iconType:"svg",iconContent:t.jsx(et,{})})})}):a.idInput==="Borrar"?t.jsx("td",{children:t.jsx("div",{className:f,children:t.jsx(re,{onClick:i=>{a.value!=null&&u(i,c)},iconType:"svg",iconContent:t.jsx(tt,{})})})}):t.jsx("td",{});case"noInput":return t.jsx("td",{className:"text-center",children:t.jsx("div",{className:f,children:r[a.idInput]})});default:return t.jsx("td",{className:`text-center ${f}`,children:a.content})}},ct=({columns:r,dataColumn:h,tableStyle:c=[],onInputChange:a,onButtonClick:d,data:g})=>t.jsx(t.Fragment,{children:t.jsx("div",{className:"relative overflow-x-auto shadow-md sm:rounded-lg",children:t.jsxs("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[t.jsx("thead",{className:"text-xxs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:t.jsx("tr",{children:r.map((v,u)=>t.jsx("th",{className:"px-6 py-3",children:v.title},u))})}),t.jsx("tbody",{children:g.map((v,u)=>t.jsx("tr",{className:`${c[u].trContent} border-b dark:border-gray-700`,children:h[u].map((f,i)=>t.jsx(rt,{tableStyle:c[u],dataColumn:f,data:v,column:f,rowIndex:u,onInputChange:a,onButtonClick:d},i))},u))})]})})});function mt(){const{handleInputChange:r,handleButtonClick:h,loadMoreData:c,handleCloseModal:a,handleOpenModal:d,handleDeleteProducto:g,handleBackEditMod:v,actualizaAllinventarios:u,datosModificacion:f,mappedStyleTable:i,mappeddProductosInventario:y,plantillaFiltersInventario:m,plantillaProductoInventarioListado:C,editMode:I,ResumenProductoInventario:L,resumeProduct:P,isOpen:k,currentPage:S,itemsPerPage:j,loadedData:A}=st();return p.useEffect(()=>{u()},[]),t.jsxs("form",{className:"text-white",children:[t.jsxs("div",{className:"bg-zinc-700 p-4 rounded mb-6 flex justify-between items-center",children:[t.jsx("div",{className:"flex-grow text-left",children:t.jsx("h2",{children:"PRODUCTOS INVENTARIO"})}),t.jsx("div",{className:"flex-grow text-right"}),t.jsx("div",{className:"ml-3",children:I?t.jsx(se,{onClick:v,useCustomOnClick:!0}):t.jsx(se,{})})]}),t.jsx("div",{children:I?t.jsx("div",{className:"mt-3",children:t.jsx(at,{columns:f,rowIndex:0,onInputChange:r,onButtonClick:h})}):t.jsxs(t.Fragment,{children:[t.jsx(nt,{filters:m}),t.jsx("div",{className:"mb-10 mt-4",children:t.jsx(lt,{dataLength:S*j,next:c,hasMore:!0,loader:t.jsx("h4",{}),endMessage:t.jsx("p",{style:{textAlign:"center"},children:t.jsx("b",{children:"Yay! You have seen it all"})}),children:y&&i&&t.jsx(ct,{tableStyle:i,columns:C,dataColumn:y,data:A,onInputChange:r,onButtonClick:h})})})]})}),t.jsx(it,{title:"¿DESEA ELIMINAR?",body:t.jsx(ot,{data:[P],columns:L}),isOpen:k,closeModal:a,openModal:d,footer:t.jsx(ue,{buttonText:"Aceptar",idInput:"btDelete",rowIndex:1,onClick:g})})]})}export{mt as default};
