import{i as P,r as F}from"./index-c9f7c851.js";import{s as y,g as O}from"./dateUtil-160cab1d.js";const i=async()=>{try{return(await P.get("/ordenProduccion")).data}catch(s){return console.error("Error fetching ordenes de produccion:",s),[]}},M=async s=>{try{return await P.post("/ordenProduccion",s)}catch(c){console.error("Error adding orden de produccion:",c)}},m=async(s,c)=>{try{return await P.put(`/ordenProduccion/${s}`,c)}catch(d){console.error("Error updating orden by id:",d)}},H=async(s,c,d)=>{try{const{data:l,status:p}=await P.put(`/ordenProduccion/${s}/productos/${c}`,d);return p===200?l:null}catch(l){return console.error("Error updating producto in orden de producción:",l),null}},j=async(s,c)=>{try{return(await P.delete(`/ordenProduccion/${s}/productos/${c}`)).data}catch(d){throw console.error("ERROR",d),d}},K=()=>{const[s,c]=F.useState(!0),d=async e=>{c(!0);try{const o=await i();(!Array.isArray(o)||o.length===0)&&console.error("No se encontraron órdenes de producción.");const r=o.length+1;return e.idParte=r,o.push(e),y("ordenesProduccion",o),e}catch(o){console.error("Error al cargar o agregar orden de producción:",o)}finally{c(!1)}},l=async e=>{try{const r=(await i()).find(a=>a.idParte===e);return r||(console.error(`Orden de producción con idParte ${e} no encontrada.`),null)}catch(o){return console.error("Error al obtener la orden de producción por ID:",o),null}},p=()=>{const e=O("datosTemporales");return e!==null?e:null},b=e=>{y("datosTemporales",e)},I=e=>{const o={idParte:e,indiceProducto:1,operario:"1",Pasada:1,Tipo:"",Color:"",Molde:"",claveComp:"",PlanchaObtenidas:0,Peso:0,Formulas:0,Planchas:0,Acelerantes:""},r=O("ordenesProduccion");if(!r)return o;const n=r.find(U=>U.idParte===e);if(!n)return o;const t=n.ordenesProduccion;return t.length===0?o:t[t.length-1]},v=()=>{const e=localStorage.getItem("productoData");if(e)return e},E=async(e,o)=>{try{const r=await l(e);if(!r){console.error(`No se encontró la orden de producción con idParte ${e}.`);return}const a=g(o,e);if(r.ordenesProduccion.length===0){console.error(`No se encontraron productos en la orden de producción con idParte ${e}.`);return}const n=r.ordenesProduccion.length-1;r.ordenesProduccion[n]=a,await f(r)}catch(r){console.error("Error al guardar la parte de laminado:",r)}},C=e=>e.map((o,r)=>({...o,indiceProducto:r+1})),D=(e,o)=>e.map(r=>{const a=Object.keys(o).find(n=>n.toLowerCase()===r.title.toLowerCase());return a?{...r,defaultValue:o[a],value:o[a]}:r}),A=(e,o,r=[])=>e.map(a=>{const n=o.find(u=>u.title===a.title),t={...a};return n&&Object.keys(t).forEach(u=>{!r.includes(u)&&u in n&&(t[u]=n[u])}),t}),w=(e,o,r)=>e.map(a=>{let n=a;switch(a.title){case"IDPARTE":n={...a,defaultValue:o,value:o};break;case"OPERARIO":n={...a,defaultValue:r.operario,value:r.operario};break;case"INDICE PRODUCTO":n={...a,defaultValue:r.indiceProducto,value:r.indiceProducto};break;case"ID PRODUCT":n={...a,defaultValue:r.indiceProducto,value:r.indiceProducto};break;case"FECHA":n={...a,defaultValue:r.fecha,value:r.fecha};break;case"BAMBURI":n={...a,defaultValue:r.bamburi,value:r.bamburi};break;case"PASADA":n={...a,defaultValue:r.pasada,value:r.pasada};break;case"TIPO":n={...a,defaultValue:r.tipo,value:r.tipo};break;case"COLOR":n={...a,defaultValue:r.color,value:r.color};break;case"MOLDE":n={...a,defaultValue:r.molde,value:r.molde};break;case"PLANCH OB.":n={...a,defaultValue:r.planchaobtenidas,value:r.planchaobtenidas};break;case"PESO":n={...a,defaultValue:r.peso,value:r.peso};break;case"FORMULAS":n={...a,defaultValue:r.formulas,value:r.formulas};break;case"PLANCHAS":n={...a,defaultValue:r.planchas,value:r.planchas};break;case"ACELERANTES":n={...a,defaultValue:r.acelerantes,value:r.acelerantes};break}return n}),k=(e,o)=>j(e,o),f=e=>m(e.idParte,e),N=e=>H(e.idParte,e.indiceProducto,e),V=async()=>{try{const e=await i();let o=[];return e.forEach(r=>{o=[...o,...r.ordenesProduccion]}),o}catch(e){return console.error("Error al obtener todos los productos y órdenes de producción:",e),[]}},L=async()=>{try{return i()}catch{return null}},h=async()=>{try{const e=await i();return e&&e.length>0?e[e.length-1]:null}catch(e){return console.error("Error al obtener la orden de producción actual:",e),null}},S=()=>{try{const e=localStorage.getItem("ordenesProduccion");if(!e)return console.log("No hay órdenes de producción almacenadas."),null;const o=JSON.parse(e);return o.length===0?(console.log("La lista de órdenes de producción está vacía."),null):o[o.length-1]}catch(e){return console.error("Error al recuperar la orden de producción actual:",e),null}},R=(e,o,r,a)=>{if(e!==null){const n=e.findIndex(t=>t.idInput===o);if(n!==-1)return e[n]={...e[n],value:r},e;console.error(`No se encontró el descriptor de columna con idInput: ${o}`)}else{const n=a.findIndex(t=>t.idInput===o);if(n!==-1)return a[n]={...a[n],value:r},a;console.error(`No se encontró el descriptor de columna con idInput: ${o}`)}},T=async e=>await M(e),$=(e,o)=>o.some(r=>r.claveComp===e.claveComp),x=async(e,o)=>{try{c(!0);const r=await i(),a=r.findIndex(n=>n.idParte===e);return a!==-1?(r[a].ordenesProduccion.push(o),await m(e,r[a])?r:null):(console.error(`No se encontró la orden de producción con idParte ${e}.`),null)}catch(r){return console.error("Error al agregar nuevo producto a la orden de producción:",r),null}finally{c(!1)}},B=e=>(h().then(o=>{if(o)return e.idParte===o.idParte}),!1),g=(e,o,r=[])=>{const a={};return e.forEach(n=>{if(n.idInput&&n.value!==void 0&&!r.includes(n.idInput)){const t=n.idInput;t==="idParte"||t==="indiceProducto"||t==="operario"||t==="pasada"||t==="peso"||t==="formulas"||t==="planchas"?a[t]=Number(n.value):a[t]=n.value}}),a.idParte=o,a};return{isLoading:s,getDatosProducto:v,incrementarIndiceProductos:C,mapearProductoAColumnasRead:D,mapColumnDescriptorsToProducto:g,mapColumnDescriptors:A,agregarNuevoProductoOP:x,crearNuevaOrdenProduccion:T,cargarDatosOrdenProduccion:d,updateOrdenProduccion:f,obtenerUltimoProducto:I,mapearProductoAColumnas:w,getOrdenProduccionById:l,getCurrentOrderProduccion:h,getTempCurrenOrderProduccion:S,getAllProductAndAllOrder:V,getAllOrdenProduction:L,checkOrdenIdOnTemp:B,checkIfClaveCompExist:$,saveParteLaminadoActual:E,recuperarDatosTemporales:p,guardarDatosTemporales:b,updateColumnProduct:R,updateProductInOrden:N,deleteOrdenProducion:k}};export{K as u};
